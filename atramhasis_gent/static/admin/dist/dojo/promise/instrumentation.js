//>>built
define("dojo/promise/instrumentation",["./tracer","../has","../_base/lang","../_base/array"],function(e,k,g,l){function m(c,a,b){a&&a.stack&&a.stack.split("\n").slice(1).join("\n").replace(/^\s+/," ")}function p(c,a,b,d){a||m(c,b,d)}function q(c,a,b,e){l.some(d,function(b){if(b.error===c)return a&&(b.handled=!0),!0})||d.push({error:c,rejection:b,handled:a,deferred:e,timestamp:(new Date).getTime()});h||(h=setTimeout(n,f))}function n(){var c=(new Date).getTime(),a=c-f;d=l.filter(d,function(b){return b.timestamp<
a?(b.handled||m(b.error,b.rejection,b.deferred),!1):!0});h=d.length?setTimeout(n,d[0].timestamp+f-c):!1}k.add("config-useDeferredInstrumentation","report-unhandled-rejections");var d=[],h=!1,f=1E3;return function(c){var a=k("config-useDeferredInstrumentation");if(a){e.on("resolved",g.hitch(console,"log","resolved"));e.on("rejected",g.hitch(console,"log","rejected"));e.on("progress",g.hitch(console,"log","progress"));var b=[];"string"===typeof a&&(b=a.split(","),a=b.shift());if("report-rejections"===
a)c.instrumentRejected=p;else if("report-unhandled-rejections"===a||!0===a||1===a)c.instrumentRejected=q,f=parseInt(b[0],10)||f;else throw Error("Unsupported instrumentation usage \x3c"+a+"\x3e");}}});
//# sourceMappingURL=instrumentation.js.map