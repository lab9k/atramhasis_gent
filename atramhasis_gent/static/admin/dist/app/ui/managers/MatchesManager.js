//>>built
require({cache:{"url:app/ui/managers/templates/MatchesManager.html":'\x3cdiv\x3e\n  \x3cdiv class\x3d"row relation-row" style\x3d"margin-bottom: 5px;"\x3e\n    \x3cdiv class\x3d"large-10 columns"\x3e\n      \x3ch5 data-dojo-attach-point\x3d"loadingMatchesNode" style\x3d"display: none;"\x3e\x3ci class\x3d"fa fa-spinner fa-pulse"\x3e\x3c/i\x3e\x26nbsp;Loading matches..\x3c/h5\x3e\n    \x3c/div\x3e\n    \x3cdiv class\x3d"large-2 columns"\x3e\n      \x3ca style\x3d"float: right;" href\x3d"#" class\x3d"button tiny" data-dojo-attach-event\x3d"onClick: _addMatches" title\x3d"Add match"\x3eAdd Match\x26nbsp;\x26nbsp;\x3ci class\x3d"fa fa-plus"\x3e\x3c/i\x3e\x3c/a\x3e\n    \x3c/div\x3e\n  \x3c/div\x3e\n  \x3cdiv class\x3d"row relation-row"\x3e\n    \x3cdiv class\x3d"large-12 columns"\x3e\n      \x3cp\x3eBroad\x3c/p\x3e\n    \x3c/div\x3e\n  \x3c/div\x3e\n  \x3cdiv class\x3d"row large-12 columns"\n       data-dojo-attach-point\x3d"broadGridNode"\x3e\n  \x3c/div\x3e\n\n  \x3cdiv class\x3d"row relation-row"\x3e\n    \x3cdiv class\x3d"large-12 columns"\x3e\n      \x3cp\x3eClose\x3c/p\x3e\n    \x3c/div\x3e\n  \x3c/div\x3e\n  \x3cdiv class\x3d"row large-12 columns"\n       data-dojo-attach-point\x3d"closeGridNode"\x3e\n  \x3c/div\x3e\n\n  \x3cdiv class\x3d"row relation-row"\x3e\n    \x3cdiv class\x3d"large-12 columns"\x3e\n      \x3cp\x3eExact\x3c/p\x3e\n    \x3c/div\x3e\n  \x3c/div\x3e\n  \x3cdiv class\x3d"row large-12 columns"\n       data-dojo-attach-point\x3d"exactGridNode"\x3e\n  \x3c/div\x3e\n\n  \x3cdiv class\x3d"row relation-row"\x3e\n    \x3cdiv class\x3d"large-12 columns"\x3e\n      \x3cp\x3eNarrow\x3c/p\x3e\n    \x3c/div\x3e\n  \x3c/div\x3e\n  \x3cdiv class\x3d"row large-12 columns"\n       data-dojo-attach-point\x3d"narrowGridNode"\x3e\n  \x3c/div\x3e\n\n  \x3cdiv class\x3d"row relation-row"\x3e\n    \x3cdiv class\x3d"large-12 columns"\x3e\n      \x3cp\x3eRelated\x3c/p\x3e\n    \x3c/div\x3e\n  \x3c/div\x3e\n  \x3cdiv class\x3d"row large-12 columns"\n       data-dojo-attach-point\x3d"relatedGridNode"\x3e\n  \x3c/div\x3e\n\x3c/div\x3e'}});
define("app/ui/managers/MatchesManager","dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/dom-construct dojo/dom-class dojo/dom-style dojo/json dojo/topic dojo/on dojo/promise/all dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/MatchesManager.html dstore/Memory dstore/Trackable dgrid/OnDemandGrid dgrid/extensions/DijitRegistry dgrid/extensions/ColumnResizer ../../utils/DomUtils ../dialogs/AddMatchesDialog".split(" "),function(f,d,e,g,v,w,x,y,l,m,n,p,q,h,k,r,s,t,z,u){return f([n,
p],{templateString:q,baseClass:"matches-manager",languageController:null,listController:null,conceptSchemeController:null,concept:null,scheme:null,matchTypes:null,_loaded:!1,_broadStore:null,_broadGrid:null,_narrowStore:null,_narrowGrid:null,_relatedStore:null,_relatedGrid:null,_exactStore:null,_exactGrid:null,_closeStore:null,_closeGrid:null,_index:0,_matchesDialog:null,postCreate:function(){this.inherited(arguments);var a=f([h,k]);this._broadStore=new a({data:[]});this._broadGrid=this._createGrid({collection:this._broadStore},
this.broadGridNode);this._narrowStore=new a({data:[]});this._narrowGrid=this._createGrid({collection:this._narrowStore},this.narrowGridNode);this._relatedStore=new a({data:[]});this._relatedGrid=this._createGrid({collection:this._relatedStore},this.relatedGridNode);this._exactStore=new a({data:[]});this._exactGrid=this._createGrid({collection:this._exactStore},this.exactGridNode);this._closeStore=new a({data:[]});this._closeGrid=this._createGrid({collection:this._closeStore},this.closeGridNode);this.concept&&
this.concept.matches&&this._loadMatches(this.concept.matches);this._matchesDialog=new u({concept:this.concept,externalSchemeStore:this.conceptSchemeController.getExternalSchemeStore(),conceptSchemeController:this.conceptSchemeController,matchTypesList:this.listController.getMatchTypes()});this._matchesDialog.startup();this.own(l(this._matchesDialog,"match.add",e.hitch(this,function(a){this._addNewMatch(a.match,a.matchType)})))},startup:function(){this.inherited(arguments);this._broadGrid.startup();
this._narrowGrid.startup();this._relatedGrid.startup();this._exactGrid.startup();this._closeGrid.startup()},reset:function(){var a=f([h,k]);this._broadStore=new a({data:[]});this._broadGrid.set("collection",this._broadStore);this._narrowStore=new a({data:[]});this._narrowGrid.set("collection",this._narrowStore);this._relatedStore=new a({data:[]});this._relatedGrid.set("collection",this._relatedStore);this._exactStore=new a({data:[]});this._exactGrid.set("collection",this._exactStore);this._closeStore=
new a({data:[]});this._closeGrid.set("collection",this._closeStore);this._matchesDialog&&this._matchesDialog.reset()},_createGrid:function(a,c){var b={label:{label:"",get:function(a){return a.data.label}},uri:{label:"",renderCell:function(a){if(a&&a.data)return g.create("a",{href:a.data.uri,target:"_blank",title:a.data.uri,innerHTML:'\x3ci class\x3d"fa fa-external-link"\x3e\x3c/i\x3e\x26nbsp;\x26nbsp;'+a.data.uri})}},remove:{label:"",renderCell:e.hitch(this,function(a){if(void 0===a.id)return null;
var b=g.create("div",{"class":"dGridHyperlink"});g.create("a",{href:"#",title:"Remove match",className:"fa fa-trash",innerHTML:"",onclick:e.hitch(this,function(b){b.preventDefault();this._removeRow(a.id,a.type)})},b);return b})}},b=new (f([r,s,t]))({className:"dgrid-autoheight",collection:a.collection,columns:b,showHeader:!1,noDataMessage:"",loadingMessage:"Fetching data.."},c);b.on("dgrid-error",function(a){});return b},setConcept:function(a){a&&(this.concept=a,this.reset(),this.concept.matches&&
this._loadMatches(this.concept.matches))},_loadMatches:function(a){if(a){var c=[];this.loadingMatchesNode.style.display="inline-block";a.broad&&d.forEach(a.broad,function(a){c.push(this.conceptSchemeController.getMatch(a,"broad").then(e.hitch(this,function(a){this._addMatch(a,this._broadStore)})))},this);a.close&&d.forEach(a.close,function(a){c.push(this.conceptSchemeController.getMatch(a,"close").then(e.hitch(this,function(a){this._addMatch(a,this._closeStore)})))},this);a.exact&&d.forEach(a.exact,
function(a){c.push(this.conceptSchemeController.getMatch(a,"exact").then(e.hitch(this,function(a){this._addMatch(a,this._exactStore)})))},this);a.narrow&&d.forEach(a.narrow,function(a){c.push(this.conceptSchemeController.getMatch(a,"narrow").then(e.hitch(this,function(a){this._addMatch(a,this._narrowStore)})))},this);a.related&&d.forEach(a.related,function(a){c.push(this.conceptSchemeController.getMatch(a,"related").then(e.hitch(this,function(a){this._addMatch(a,this._relatedStore)})))},this);m(c).then(e.hitch(this,
function(a){this.loadingMatchesNode.style.display="none";this._loaded=!0}))}},getData:function(){var a={};if(this._loaded){var c={};c.narrow=d.map(this._narrowStore.data,function(a){return a.data.uri});c.broad=d.map(this._broadStore.data,function(a){return a.data.uri});c.related=d.map(this._relatedStore.data,function(a){return a.data.uri});c.close=d.map(this._closeStore.data,function(a){return a.data.uri});c.exact=d.map(this._exactStore.data,function(a){return a.data.uri});a.matches=c}else a.matches=
this.concept&&this.concept.matches?this.concept.matches:{};return a},_addNewMatch:function(a,c){var b=null;switch(c){case "broad":b=this._broadStore;break;case "narrow":b=this._narrowStore;break;case "related":b=this._relatedStore;break;case "close":b=this._closeStore;break;case "exact":b=this._exactStore}a&&b&&this._addMatch({data:{id:a.id,label:a.label,uri:a.uri},type:a.type},b)},_addMatch:function(a,c){return!d.some(c.data,function(b){return b.data.id==a.data.id})?(c.add(a),!0):!1},_addMatches:function(a){a?
a.preventDefault():null;this._matchesDialog.show()},_removeRow:function(a,c){var b=null;switch(c){case "broad":b=this._broadStore;break;case "close":b=this._closeStore;break;case "exact":b=this._exactStore;break;case "narrow":b=this._narrowStore;break;case "related":b=this._relatedStore}b&&b.remove(a)}})});
//# sourceMappingURL=MatchesManager.js.map