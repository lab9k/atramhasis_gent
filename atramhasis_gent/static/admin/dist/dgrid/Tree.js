//>>built
define("dgrid/Tree","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/aspect dojo/dom-construct dojo/dom-class dojo/on dojo/query dojo/when ./util/has-css3 ./Grid dojo/has!touch?./util/touch".split(" "),function(v,w,x,B,l,k,y,t,z,u,C,m){return v(null,{collapseOnRefresh:!1,enableTreeTransitions:!0,treeIndentWidth:9,constructor:function(){this._treeColumnListeners=[]},shouldExpand:function(a,c,b){return b},expand:function(a,c,b){if(this._treeColumn){var e=this,f=a.element?a:this.row(a),A=!!this._expanded[f.id],
q=u("transitionend"),r;a=f.element;a=-1<a.className.indexOf("dgrid-expando-icon")?a:t(".dgrid-expando-icon",a)[0];b=b||!this.enableTreeTransitions;if(a&&a.mayHaveChildren&&(b||c!==A)){var h=void 0===c?!this._expanded[f.id]:c;k.replace(a,"ui-icon-triangle-1-"+(h?"se":"e"),"ui-icon-triangle-1-"+(h?"e":"se"));k.toggle(f.element,"dgrid-row-expanded",h);c=f.element;var d=c.connected,g,s,p={};if(!d){var d=p.container=c.connected=l.create("div",{className:"dgrid-tree-container"},c,"after"),n=function(a){var b=
e._renderedCollection.getChildren(f.data);e.sort&&0<e.sort.length&&(b=b.sort(e.sort));b.track&&e.shouldTrackCollection&&(d._rows=a.rows=[],b=b.track(),d._handles=[b.tracking,e._observeCollection(b,d,a)]);return"start"in a?b.fetchRange({start:a.start,end:a.start+a.count}):b.fetch()};"level"in a&&(n.level=a.level);if(this.renderQuery)r=this.renderQuery(n,p);else{var m=l.create("div",null,d);r=this._trackError(function(){return e.renderQueryResults(n(p),m,w.mixin({rows:p.rows},"level"in n?{queryLevel:n.level}:
null)).then(function(a){l.destroy(m);return a})})}q&&y(d,q,this._onTreeTransitionEnd)}d.hidden=!h;g=d.style;!q||b?(g.display=h?"block":"none",g.height=""):(h?(g.display="block",s=d.scrollHeight,g.height="0px"):(k.add(d,"dgrid-tree-resetting"),g.height=d.scrollHeight+"px"),setTimeout(function(){k.remove(d,"dgrid-tree-resetting");g.height=h?s?s+"px":"auto":"0px"},0));h?this._expanded[f.id]=!0:delete this._expanded[f.id]}return z(r)}},_configColumns:function(){var a=this.inherited(arguments);this._expanded=
{};for(var c=0,b=a.length;c<b;c++)if(a[c].renderExpando){this._configureTreeColumn(a[c]);break}return a},insertRow:function(a){var c=this.inherited(arguments),b=this.row(c);(b=this.shouldExpand(b,this._currentLevel,this._expanded[b.id]))&&this.expand(c,!0,!0);(b||!this.collection.mayHaveChildren||this.collection.mayHaveChildren(a))&&k.add(c,"dgrid-row-expandable");return c},removeRow:function(a,c){var b=a.connected,e={};b&&(b._handles&&(x.forEach(b._handles,function(a){a.remove()}),delete b._handles),
b._rows&&(e.rows=b._rows),t("\x3e.dgrid-row",b).forEach(function(a){this.removeRow(a,!0,e)},this),b._rows&&(b._rows.length=0,delete b._rows),c||l.destroy(b));this.inherited(arguments)},cleanup:function(){this.inherited(arguments);this.collapseOnRefresh&&(this._expanded={})},_destroyColumns:function(){this.inherited(arguments);for(var a=this._treeColumnListeners,c=a.length;c--;)a[c].remove();this._treeColumnListeners=[];this._treeColumn=null},_calcRowHeight:function(a){var c=a.connected;return this.inherited(arguments)+
(c?c.offsetHeight:0)},_configureTreeColumn:function(a){if(!a._isConfiguredTreeColumn){var c=a.renderCell||this._defaultRenderCell;a._isConfiguredTreeColumn=!0;a.renderCell=function(b,e,f,h){var d=a.grid,g=Number(h&&h.queryLevel)+1,k=!d.collection.mayHaveChildren||d.collection.mayHaveChildren(b),g=d._currentLevel=isNaN(g)?0:g,d=a.renderExpando(g,k,d._expanded[d.collection.getIdentity(b)],b);d.level=g;d.mayHaveChildren=k;(b=c.call(a,b,e,f,h))&&b.nodeType?(f.appendChild(d),f.appendChild(b)):f.insertBefore(d,
f.firstChild)};var b;this._treeColumn=a;var e=this,f=".dgrid-content .dgrid-column-"+a.id;"function"!==typeof a.renderExpando&&(a.renderExpando=this._defaultRenderExpando);this._treeColumnListeners.push(this.on(a.expandOn||".dgrid-expando-icon:click,"+f+":dblclick,"+f+":keydown",function(a){var c=e.row(a);(!e.collection.mayHaveChildren||e.collection.mayHaveChildren(c.data))&&(("keydown"!==a.type||32===a.keyCode)&&!("dblclick"===a.type&&b&&1<b.count&&c.id===b.id&&-1<a.target.className.indexOf("dgrid-expando-icon")))&&
e.expand(c);-1<a.target.className.indexOf("dgrid-expando-icon")&&(b&&b.id===e.row(a).id?b.count++:b={id:e.row(a).id,count:1})}));u("touch")&&this._treeColumnListeners.push(this.on(m.selector(f,m.dbltap),function(){e.expand(this)}))}},_defaultRenderExpando:function(a,c,b){var e=this.grid.isRTL?"right":"left",f="dgrid-expando-icon";c&&(f+=" ui-icon ui-icon-triangle-1-"+(b?"se":"e"));return l.create("div",{className:f,innerHTML:"\x26nbsp;",style:"margin-"+e+": "+a*this.grid.treeIndentWidth+"px; float: "+
e+";"})},_onNotification:function(a,c){"delete"===c.type&&delete this._expanded[c.id];this.inherited(arguments)},_onTreeTransitionEnd:function(a){var c=this,b=this.style.height;b&&(this.style.display="0px"===b?"none":"block");a&&(k.add(this,"dgrid-tree-resetting"),setTimeout(function(){k.remove(c,"dgrid-tree-resetting")},0));this.style.height=""}})});
//# sourceMappingURL=Tree.js.map